matrix:
  include:
    - os: linux
      sudo: false
      language: node_js
      node_js: 10
    - os: osx
      language: node_js
      node_js: 10

env:
  global:
    - SCROLEX_MODE=passthru
    - secure: BeM6mpPEATdeFcAr/222QBZ9vRkZtU2WOi9QQy3mxsuDbWfM8RxYESIEJLipyhW9kXGoe6HGMqm4Kz9B/c4jrzeSXPpKnW7mIfnyqN+hhq1ctW9qPSqodu+fYNhdDxXh5wylml7hnIJzU70vFGrFknZRE2FYk5XvyHg2ImIKDJw=
    - secure: RJ5UpdXms9QkraylZ11OBfmcRrmKnb254Yj0yCDAvZmg+n+3jSTwMgGvPY8Ih8X/R1JeW3VTtFDkJXXPnjjfpNg1M91u4CAEUOMPciCudYcoF6GKb8psnOzneTTX5M7zuJSzknGdpv/foldxiPYxiY5Hn5bfjmikhAEl+QX/R0Y=
    - secure: BXf2buPt/DA09M5ZUdp/LpOWtUuz1mfCBopLyxvHv3Sl3ln+Az57wWsM2+Re+77lUOgihR2f6lXYfNUmQuSUo157rZPunQCqM/DJhK69KhREEB6SJDaJF3FVlnGla+Cwwb1IQUtMopqX9pBYD7w/zyWQFJCi20O57JEVIdfZZS8=
    - secure: AaDI3OLTcwau2tu9jTtR0eHpylSUudYua9aKH3C540Lm2scQhQcT4IbMa6KXgrY+1UchapS9gUuClH8QwgJo61tJjtOqvmCgZ2EkmZg68pzw/25zwv7LSzYASbZvKahulV/giZdxFLGOpPhNhKbG70/owYXjKFENi5LoZKc8Y+c=

addons:
  apt:
    update: true
    packages:
      - xz-utils
  homebrew:
    update: true
    packages:
      - coreutils
      - gnu-sed

git:
  depth: 3

before_install:
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then command -v bundle || gem install bundler; fi
  - |
    if [ "$TRAVIS_OS_NAME" = "linux" ]; then
      sctmp="$( mktemp -d)" && pushd "${sctmp}" > /dev/null || return
      scversion="latest" # or "v0.4.7", or "stable"
      curl -k -sSLO "https://storage.googleapis.com/shellcheck/shellcheck-${scversion?}.linux.x86_64.tar.xz"
      curl -k -sSLO "https://storage.googleapis.com/shellcheck/shellcheck-${scversion?}.linux.x86_64.tar.xz.sha512sum"
      if sha512sum -c --quiet "shellcheck-${scversion?}.linux.x86_64.tar.xz.sha512sum"; then
        tar -x --xz -f "shellcheck-${scversion?}.linux.x86_64.tar.xz"
        sudo install -v -m0755 "${sctmp}/shellcheck-${scversion}/shellcheck" "$(command -v shellcheck)"
        grep 'binary was compiled' "${sctmp}/shellcheck-${scversion}/README.txt"
      fi
      popd > /dev/null || return
    fi

before_script:
  - bash --version
  - awk --version
  - shellcheck --version

before_cache:
  - rm -f ./node_modules/.bin/which
  # cache:
  #   apt: true
  #   directories:
  #   - .lanyon

script: test/acceptance.sh

deploy:
  skip_cleanup: true
  provider: script
  script: ./node_modules/lanyon/scripts/ci-deploy.sh
  on:
    branch: master
    condition: $TRAVIS_OS_NAME = linux
